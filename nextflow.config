manifest {
  name = 'nf-reads-profiler'
  author = 'Sunit Jain'
  homePage = 'https://github.com/fischbachlab/nf-profile-reads'
  description = 'Metaphlan and HUMANn'
  mainScript = 'main.nf'
  defaultBranch = 'main'
  version = '0.0.2'
}

plugins {
  id 'nf-schema@2.0.0'
}

// includeConfig "$projectDir/conf/aws_batch.config"
includeConfig "$projectDir/conf/azurebatch.config"

params {

    /* 	Containers
     --------------------------------*/
    docker_container_humann3 = "gutzcontainers.azurecr.io/humann:3.9"
    docker_container_humann4 = "gutzcontainers.azurecr.io/humann:4.0.0a1"
    docker_container_metaphlan = "gutzcontainers.azurecr.io/metaphlan:4.1.0"
    docker_container_multiqc = "gutzcontainers.azurecr.io/multiqc:1.11"
    docker_container_fastp = "gutzcontainers.azurecr.io/fastp:0.23.4"
    docker_container_aws = "gutzcontainers.azurecr.io/aws-cli-bash:ubuntu"
    docker_container_sra = "gutzcontainers.azurecr.io/sra-tools-bash:latest"

    // AWS config
    aws_region = 'us-east-1'

    /* 	Execution flow parameters
     --------------------------------*/

    config_profile_name        = 'Default profile'
    config_profile_description = 'nf-profile-reads default workflow'

    /* 	Execution flow parameters
     --------------------------------*/

    singleEnd = false  //Whether we the input reads are single or paired-end
    mergeReads = false
    annotation = true
    rna = false
    cache = true
    project= "none"
    prefix="output"
    input="az://nextflow-data/fetchngs/samplesheet/samplesheet.csv"
	  outdir="az://nextflow-analysis/workflows"
    rna = false       // Is the input data RNA? Requires "taxonomic_profile" to be set as well.
    taxonomic_profile = null    // <S3Path> Use in case metaphlan results are already available.
    annotation  = true  // whether annotation is enabled  or not

    /* 	Processing parameters
     --------------------------------*/

    //BowTie2 databases for MetaPhlAn
    metaphlan_index="mpa_vJan25_CHOCOPhlAnSGB_202503"
    metaphlan_db="/dbs/omicsdata/metagenome-dbs/metaphlan/metaphlan4/vJan25"
    // Separate MetaPhlAn database for HUMAnN 4 (should be compatible with HUMAnN 4 vOct22)
    humann_metaphlan_index="mpa_vOct22_CHOCOPhlAnSGB_202403"
    humann_metaphlan_db="/dbs/omicsdata/metagenome-dbs/metaphlan/metaphlan4/vOct22_202403"
    bt2options="very-sensitive" //presets options for BowTie2

    // ChocoPhlAn and UniRef databases for HUMANn analysis
    chocophlan="/dbs/omicsdata/metagenome-dbs/humann/4.0/chocophlan"
    uniref="/dbs/omicsdata/metagenome-dbs/humann/4.0/uniref/uniref"
    utility_mapping="/dbs/omicsdata/metagenome-dbs/humann/4.0/utility_mapping/utility_mapping"

    // Additional command line parameters
    humann_params=""
    
    // HUMAnN table processing parameters
    process_humann_tables = true  // Enable HUMAnN table regrouping and splitting
    humann_regroups = "uniref90_ko,uniref90_rxn"  // Comma-separated list of regroup types
    split_size = 100  // Maximum samples per split for memory management

    // SRA download settings
    max_retry_count = 3
    max_parallel_downloads = 3

    // Limit size
    nreads = 33333333
    minreads = 100000
    /* 	Initialisation
     --------------------------------*/


    //These are used to print version and help
    help = null
    version = null

    multiqc_config="$projectDir/conf/multiqc_config.yaml"
}


timeline {
  enabled = true
  overwrite = true
  file = "$params.outdir/$params.project/execution_reports/timeline.html"
}

report {
  enabled = true
  overwrite = true
  file = "$params.outdir/$params.project/execution_reports/report.html"
}

dag {
    enabled = true
    overwrite = true
    file = "$params.outdir/$params.project/execution_reports/pipeline_dag.html"
}

